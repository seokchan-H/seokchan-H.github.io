<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Gatsby Starter Blog RSS Feed]]></title><description><![CDATA[A starter blog demonstrating what Gatsby can do.]]></description><link>https://seokchan-H.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Sat, 19 Apr 2025 16:36:11 GMT</lastBuildDate><item><title><![CDATA[[PSQL] 트랜잭션 정합성 테스트]]></title><description><![CDATA[사전지식 테스트 전에 필요한 사전지식을 공유합니다. 격리수준 READ_UNCOMMITTED 다른 트랜잭션이 수정 중인 데이터를 읽을 수 있습니다. 대부분의 DBMS 에서 지원하지 않습니다. READ_COMMITTED…]]></description><link>https://seokchan-H.github.io/2025.04/2025.04.19/</link><guid isPermaLink="false">https://seokchan-H.github.io/2025.04/2025.04.19/</guid><pubDate>Sat, 19 Apr 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;사전지식&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;테스트 전에 필요한 사전지식을 공유합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;격리수준&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;READ_UNCOMMITTED
&lt;ul&gt;
&lt;li&gt;다른 트랜잭션이 수정 중인 데이터를 읽을 수 있습니다.&lt;/li&gt;
&lt;li&gt;대부분의 DBMS 에서 지원하지 않습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;READ_COMMITTED
&lt;ul&gt;
&lt;li&gt;다른 트랜잭션이 커밋한 데이터만 읽을 수 있습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;REPEATABLE_READ
&lt;ul&gt;
&lt;li&gt;트랜잭션이 시작된 시점의 데이터를 읽습니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;SERIALIZABLE
&lt;ul&gt;
&lt;li&gt;순차를 적용합니다.&lt;/li&gt;
&lt;li&gt;PSQL 은 Serializable Snapshot Isolation (SSI) 를 사용하고 충돌 시 rollback(후속 트랜잭션) 합니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;SQL 표준보다 강력한 PSQL 의 격리 수준&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.postgresql.org/docs/current/transaction-iso.html#TRANSACTION-ISO&quot;&gt;공문 참조 (13.2. 트랜잭션 격리)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Isolation Level&lt;/th&gt;
&lt;th&gt;Dirty Read&lt;/th&gt;
&lt;th&gt;Nonrepeatable Read&lt;/th&gt;
&lt;th&gt;Phantom Read&lt;/th&gt;
&lt;th&gt;Serialization Anomaly&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Read uncommitted&lt;/td&gt;
&lt;td&gt;Allowed, but not in PG&lt;/td&gt;
&lt;td&gt;Possible&lt;/td&gt;
&lt;td&gt;Possible&lt;/td&gt;
&lt;td&gt;Possible&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read committed&lt;/td&gt;
&lt;td&gt;Not possible&lt;/td&gt;
&lt;td&gt;Possible&lt;/td&gt;
&lt;td&gt;Possible&lt;/td&gt;
&lt;td&gt;Possible&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Repeatable read&lt;/td&gt;
&lt;td&gt;Not possible&lt;/td&gt;
&lt;td&gt;Not possible&lt;/td&gt;
&lt;td&gt;Allowed, but not in PG&lt;/td&gt;
&lt;td&gt;Possible&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Serializable&lt;/td&gt;
&lt;td&gt;Not possible&lt;/td&gt;
&lt;td&gt;Not possible&lt;/td&gt;
&lt;td&gt;Not possible&lt;/td&gt;
&lt;td&gt;Not possible&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;PSQL 은 실제로 3가지 격리 수준만 구현되어 있습니다.
PSQL 의 Read uncommitted 는 Read committed 처럼 동작합니다.
PSQL 의 Repeatable read 는 Phantom Read 를 허용하지 않습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;직렬화 이상 (Serialization Anomaly)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;이상 현상 (Anomaly)&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;th&gt;Read Uncommitted&lt;/th&gt;
&lt;th&gt;Read Committed&lt;/th&gt;
&lt;th&gt;Repeatable Read&lt;/th&gt;
&lt;th&gt;Serializable&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Dirty Write&lt;/td&gt;
&lt;td&gt;커밋되지 않은 트랜잭션의 데이터를 읽고 덮어씀&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dirty Read&lt;/td&gt;
&lt;td&gt;커밋되지 않은 트랜잭션의 데이터를 읽음&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Non-repeatable Read&lt;/td&gt;
&lt;td&gt;같은 데이터를 두 번 읽었는데 값이 바뀜&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Phantom Read&lt;/td&gt;
&lt;td&gt;같은 조건의 쿼리 결과가 반복 시 달라짐 (새 행 생김 등)&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Lost Update&lt;/td&gt;
&lt;td&gt;두 트랜잭션이 같은 데이터를 읽고 둘 다 업데이트 → 하나 덮어씀&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;✅ 방지 (일부)&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read Skew&lt;/td&gt;
&lt;td&gt;한 트랜잭션에서 읽은 값들이 서로 논리적으로 안 맞는 문제&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Write Skew&lt;/td&gt;
&lt;td&gt;서로 조건 만족 후 업데이트했지만 전체 논리적으로는 제약 위반&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Serialization Anomaly&lt;/td&gt;
&lt;td&gt;순차 실행으로는 절대 일어날 수 없는 결과&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;❌ 허용&lt;/td&gt;
&lt;td&gt;✅ 방지&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Spring Data JPA 설정방식&lt;/h2&gt;
&lt;h3&gt;락 유형&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;격리수준은 트랜잭션간의 영향도를 낮추는 방법이고
락은 특정 데이터에 대한 접근을 제한하는 방법이다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;낙관락&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;어플리케이션 상에서 Lock 을 처리합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;@Version 컬럼 지정&lt;/li&gt;
&lt;li&gt;OPTIMISTIC
&lt;ul&gt;
&lt;li&gt;수정시에만 @Version 이 증가된다.&lt;/li&gt;
&lt;li&gt;어플리케이션 레벨에서 Dirty Read 와 Non-repeatable Read 를 방지합니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;OPTIMISTIC_FORCE_INCREMENT
&lt;ul&gt;
&lt;li&gt;OPTIMISTIC 기능 제공&lt;/li&gt;
&lt;li&gt;조회시에도 @Version 이 증가된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;비관락&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;DB 상의 Lock 을 사용합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;PESSIMISTIC_READ
&lt;ul&gt;
&lt;li&gt;공유락 : 다른 트랜잭션이 읽을 수 있지만 수정은 불가&lt;/li&gt;
&lt;li&gt;(i.e. Shared Lock : for share)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;PESSIMISTIC_WRITE
&lt;ul&gt;
&lt;li&gt;배타락 : 다른 트랜잭션이 읽기/쓰기 모두 불가&lt;/li&gt;
&lt;li&gt;(i.e. Exclusive Lock : for update)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;낙관 + 비관락 병행
&lt;ul&gt;
&lt;li&gt;PESSIMISTIC_FORCE_INCREMENT&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Spring Transactional 애서 격리수준 설정하기&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;DEFAULT
&lt;ul&gt;
&lt;li&gt;데에터베이스의 기본 설정을 따른다.&lt;/li&gt;
&lt;li&gt;PSQL 은 READ_COMMITTED 을 기본으로 사용합니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;READ_UNCOMMITTED&lt;/li&gt;
&lt;li&gt;READ_COMMITTED&lt;/li&gt;
&lt;li&gt;REPEATABLE_READ&lt;/li&gt;
&lt;li&gt;SERIALIZABLE&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Spring Data JPA 에서 테스트를 진행한다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;임계구역 경합 테스트&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;두 개의 트랜잭션에서 동일한 데이터를 수정하는 경우를 테스트합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;BeforeUpdate&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;A 트랜잭션 시작&lt;/li&gt;
&lt;li&gt;A 조회&lt;/li&gt;
&lt;li&gt;&lt;em&gt;&lt;code class=&quot;language-text&quot;&gt;B 트랜잭션 시작&lt;/code&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;&lt;code class=&quot;language-text&quot;&gt;B 조회&lt;/code&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;&lt;code class=&quot;language-text&quot;&gt;A 수정&lt;/code&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;B 수정&lt;/li&gt;
&lt;li&gt;A 트랜잭션 커밋&lt;/li&gt;
&lt;li&gt;B 트랜잭션 커밋&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;LockType \ Isolation Level&lt;/th&gt;
&lt;th&gt;&lt;code class=&quot;language-text&quot;&gt;*READ_UNCOMMITTED*&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code class=&quot;language-text&quot;&gt;*READ_COMMITTED*&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code class=&quot;language-text&quot;&gt;*REPEATABLE_READ*&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code class=&quot;language-text&quot;&gt;*SERIALIZABLE*&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;@Version&lt;/code&gt; Only&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*OPTIMISTIC*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*OPTIMISTIC_FORCE_INCREMENT*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*PESSIMISTIC_READ*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;C&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;C&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;C&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;C&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*PESSIMISTIC_WRITE*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;✔&lt;/td&gt;
&lt;td&gt;✔&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;D&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;D&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*PESSIMISTIC_FORCE_INCREMENT*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;E&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;E&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;E&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;E&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;AfterUpdate&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;A 트랜잭션 시작&lt;/li&gt;
&lt;li&gt;A 조회&lt;/li&gt;
&lt;li&gt;&lt;em&gt;&lt;code class=&quot;language-text&quot;&gt;A 수정&lt;/code&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;&lt;code class=&quot;language-text&quot;&gt;B 트랜잭션 시작&lt;/code&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;&lt;code class=&quot;language-text&quot;&gt;B 조회&lt;/code&gt;&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;B 수정&lt;/li&gt;
&lt;li&gt;A 트랜잭션 커밋&lt;/li&gt;
&lt;li&gt;B 트랜잭션 커밋&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;PSQL 경합 테스트 결과, BeforeUpdate 와 AfterUpdate 의 결과가 동일하다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;LockType \ Isolation Level&lt;/th&gt;
&lt;th&gt;&lt;code class=&quot;language-text&quot;&gt;*READ_UNCOMMITTED*&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code class=&quot;language-text&quot;&gt;*READ_COMMITTED*&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code class=&quot;language-text&quot;&gt;*REPEATABLE_READ*&lt;/code&gt;&lt;/th&gt;
&lt;th&gt;&lt;code class=&quot;language-text&quot;&gt;*SERIALIZABLE*&lt;/code&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;@Version&lt;/code&gt; Only&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*OPTIMISTIC*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*OPTIMISTIC_FORCE_INCREMENT*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;B&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*PESSIMISTIC_READ*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;C&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;C&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;C&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;C&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*PESSIMISTIC_WRITE*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;✔&lt;/td&gt;
&lt;td&gt;✔&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;D&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;D&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;*PESSIMISTIC_FORCE_INCREMENT*&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;E&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;E&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;E&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;E&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;A&lt;/strong&gt; : &lt;code class=&quot;language-text&quot;&gt;ObjectOptimisticLockingFailureException&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;Row was updated or deleted by another transaction (or unsaved-value mapping was incorrect)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;B&lt;/strong&gt; : &lt;code class=&quot;language-text&quot;&gt;CannotAcquireLockException&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;[ERROR: &lt;strong&gt;could not serialize access due to concurrent update&lt;/strong&gt;] [update versioned_entity set created_date=?,sequence=?,version=? where id=? and version=?]; SQL [update versioned_entity set created_date=?,sequence=?,version=? where id=? and version=?]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;C&lt;/strong&gt; : &lt;code class=&quot;language-text&quot;&gt;CannotAcquireLockException&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;[ERROR: &lt;strong&gt;deadlock detected&lt;/strong&gt;
Detail: Process 236 waits for ShareLock on transaction 906; blocked by process 237.
Process 237 waits for ShareLock on transaction 905; blocked by process 236.
Hint: See server log for query details.
Where: while updating tuple (0,53) in relation &quot;simple_entity&quot;]
[update simple_entity set created_date=?,sequence=? where id=?];
SQL [update simple_entity set created_date=?,sequence=? where id=?]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;D&lt;/strong&gt; : &lt;code class=&quot;language-text&quot;&gt;CannotAcquireLockException&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;[select se1_0.id,se1_0.created_date,se1_0.sequence from simple_entity se1_0 where se1_0.id=? &lt;strong&gt;for no key update&lt;/strong&gt;]
[ERROR: &lt;strong&gt;could not serialize access due to concurrent update&lt;/strong&gt;] [update versioned_entity set created_date=?,sequence=?,version=? where id=? and version=?]; SQL [update versioned_entity set created_date=?,sequence=?,version=? where id=? and version=?]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;E&lt;/strong&gt; : &lt;code class=&quot;language-text&quot;&gt;PessimisticLockingFailureException&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;[select ve1_0.id,ve1_0.created_date,ve1_0.sequence,ve1_0.version from versioned_entity ve1_0 where ve1_0.id=? &lt;strong&gt;for no key update nowait&lt;/strong&gt;] [ERROR: could not obtain lock on row in relation &quot;versioned_entity&quot;]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[[Kotlin] Kotlin JDSL 삽질 일기]]></title><description><![CDATA[Reflection 을 이용한 동적인 호출은 IDE 에서 호출 시점을 추적할 수 없다.
IDE…]]></description><link>https://seokchan-H.github.io/2025.02/2025.02.22/</link><guid isPermaLink="false">https://seokchan-H.github.io/2025.02/2025.02.22/</guid><pubDate>Sat, 22 Feb 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Reflection 을 이용한 동적인 호출은 IDE 에서 호출 시점을 추적할 수 없다.
IDE 가 추적할 수 없는 코드는 리팩토링이 어렵다.
그렇기에 최대한 추적 가능한 코드를 만들어야한다.&lt;/p&gt;
&lt;p&gt;최근 인계받은 프로젝트에서 호출되지 않는 생성자를 여러개 정의한 DTO 들을 발견했다.
사용하지 않는 코드들은 정리하는 것이 좋기에 이를 제거했더니, 바로 빌드가 실패했다.
IDE 에서도 사용하지 않는다고 경고를 띄우는 코드였는데, 왜 빌드가 실패했을까?&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/05487141dab593296eb4669c14682ae6/b7756/img_4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 15.18987341772152%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVR42n2OywqCUBiEe6CgRTcTy4jaRZseJI0KitLjOWoXooJe01bqwo1fx1ZB0Gxm5od/+GpolWVZGUVRcLne2B8EIog4+BLPVwQyZrvzcNw17nLDwlkRRmfSNOX7v1Lt+5DlOdPZnG7PZjCcYFqjT7bsMR2jT7Ntah9Qb7QwTJskef0frAjvj+eHLFAxMjwiZITUuSJWuqvohCcUYawJs+xn8A37OLSfRD2W/wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;img_4.png&quot;
        title=&quot;&quot;
        src=&quot;/static/05487141dab593296eb4669c14682ae6/f058b/img_4.png&quot;
        srcset=&quot;/static/05487141dab593296eb4669c14682ae6/c26ae/img_4.png 158w,
/static/05487141dab593296eb4669c14682ae6/6bdcf/img_4.png 315w,
/static/05487141dab593296eb4669c14682ae6/f058b/img_4.png 630w,
/static/05487141dab593296eb4669c14682ae6/40601/img_4.png 945w,
/static/05487141dab593296eb4669c14682ae6/78612/img_4.png 1260w,
/static/05487141dab593296eb4669c14682ae6/b7756/img_4.png 2294w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이유는 Reflection 을 사용하여 동적으로 생성자를 호출하는 코드가 있었기 때문이었다.
Reflection 을 사용하여 동적으로 생성자를 호출하는 코드는 정적인 코드를 검증하는 IDE 가 추적할 수 없다.&lt;/p&gt;
&lt;p&gt;문제가 되는 코드를 확인해보니 Kotlin JDSL 를 사용하여 selectNew 로 동적인 DTO 매핑에 사용하고 있었다.
Kotlin JDSL 의 selectNew 는 Hibernate 의 DomainResult 중 DynamicInstantiationResult 로 지원된다.&lt;/p&gt;
&lt;p&gt;DomainResult 는 DomainResultAssembler 를 사용하여 ResultSet 을 DTO 로 매핑한다.
DomainResult 는 createResultAssembler 로 자신의 상태에 맞는 DomainResultAssembler 를 생성한다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c315860b7d38fed92fac26a21e3ab7ba/599ea/img.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtUlEQVR42lWQ6XLaQBCE9SSpJGADJhjdt/YWBRI6DMhx3v9BOqOVXan8+Gpndnta03KiMEAYeJZ4rn0Pge8iCnxEoQ/3eEAaR9BKwCgJLQWU5DBa2jvJK9vnWWK1znhKcTvFeFxyjHWMhh8xmNDWo4nQChcm24GHa/Bg9Y/PvnS/g3k/oJIddLqFM/Q3jH2Pt3HE0HX0RU6IBcZpIwUlJARj4GUJUZXgRY6KNqqy1MKKgrbVdsYZbn8wDA9iwu3+gWGccO1u6Ps7lD6jrluigTYXmLk+XYnWog3dk4bzGudLb7XO1HKKm2FqS3x0zEZ/NDlOxd5G0OkOKt4sdbL0X3eSqNxvEOEKOt9TbIo8dQaP2bQVaCT9/OwVpjhCZr+g8lcSLr3Oj1DpATLZowqeiLWl9FYQ8Q516Vmtc28lfncSfZ1CkUldupDp3tYqO1iRTF7sEAsXIzab+StL6f2kty3qwrV6Z7pqvLcM753AQKadTmByMiJDe37WkoZEtCGe7TmbstmUDOe3eRE9G46NxNuFYTwvXE1OUY8QyQEi/R8WvaAKNyiDDQpvbcldMg23kPNMesBfZn4yz4x1Xk4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;img.png&quot;
        title=&quot;&quot;
        src=&quot;/static/c315860b7d38fed92fac26a21e3ab7ba/f058b/img.png&quot;
        srcset=&quot;/static/c315860b7d38fed92fac26a21e3ab7ba/c26ae/img.png 158w,
/static/c315860b7d38fed92fac26a21e3ab7ba/6bdcf/img.png 315w,
/static/c315860b7d38fed92fac26a21e3ab7ba/f058b/img.png 630w,
/static/c315860b7d38fed92fac26a21e3ab7ba/40601/img.png 945w,
/static/c315860b7d38fed92fac26a21e3ab7ba/78612/img.png 1260w,
/static/c315860b7d38fed92fac26a21e3ab7ba/599ea/img.png 1926w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이때 DynamicInstantiationResult 는 Reflection 을 사용하여 지정된 TargetClass 의 모든 생성자를 불러온다.
그 중 Argument 의 순서와 항목이 일치하는 것이 존재할 때 DynamicInstantiationAssemblerConstructorImpl 를 선택하게 된다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1b8211f8477d30ca0cab932ed38c07ca/19ab6/img_2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVR42o1SWXaDMBDjHk0CGDDGK2EJS5be/1TqjBPSLX2vHwIPHgtJ48RZj3laMJwuGMYVy/kd40zrjr61M07zFdN6w0yYlmvc55rhwwAXetTKIS9qiFIhybICTlu0oYNvexjXwrkj+nCCsQHtcUD7+N4YD1FIpHQmy0scUoHdPovvDQlvMpxSsKTWEvGxG4loRGgH9MMU60CkjKJSpEY+CX8i4Y39QSBojanrcJ4XLGRtOs1Y1wvW8y0q9WTNWFKpHVm0KMqazuV/EzayxkhqPCksqVlTLSsJWWuUVQOpDN52abTIeEV2t8zSyXIhSmjKSJtwV9FYgiMl6knA0bwi+ZUhq2TkDFHFjDh8tsU1N/6HLBLyg4PmKSpSxCo5K1U3EKR6t8+jupdIv9dPhVVVwxsLvpM8WZ4mW9c0DB4IR8Dgn21rKTVM5VFLE3ssCeJhJYIuZJp+2tmsbVFwxtvV+oqtZ0P26PsA18ciwsAy5eMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;img_2.png&quot;
        title=&quot;&quot;
        src=&quot;/static/1b8211f8477d30ca0cab932ed38c07ca/f058b/img_2.png&quot;
        srcset=&quot;/static/1b8211f8477d30ca0cab932ed38c07ca/c26ae/img_2.png 158w,
/static/1b8211f8477d30ca0cab932ed38c07ca/6bdcf/img_2.png 315w,
/static/1b8211f8477d30ca0cab932ed38c07ca/f058b/img_2.png 630w,
/static/1b8211f8477d30ca0cab932ed38c07ca/40601/img_2.png 945w,
/static/1b8211f8477d30ca0cab932ed38c07ca/78612/img_2.png 1260w,
/static/1b8211f8477d30ca0cab932ed38c07ca/19ab6/img_2.png 1664w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;여기서 Argument 는 kdsl 의 selectNew 에서 정의한 Query 의 Column 순서이다.
이 Query 가 hibernate 의 hq 로 변경된 후 조회되며, 그 결과가 ArgumentReader 에 의해 정의된 순서대로 매핑된다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;다른 Assembler 도 존재하지만 selectNew 는 기본 구현상으로는 DynamicInstantiationAssemblerConstructorImpl 로 매칭된다.&lt;/p&gt;
&lt;p&gt;그런데 내가 매칭되는 생성자를 지워버렸으니, 테스트 중에 에러가 발생했던 것이다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/daa636f0456078be07333c434ced112e/18d85/img_1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdUlEQVR42pWSzSvDARjH93e4uclJWUxs/DStxbCZFRbNy1DL60FmXtb6eQ1TysGcvOWovMQBFzlI7SCSk5KIbGgL7beP+dlFtvAcnufwfPv0/T49ChJUNPoWa++EQkH8F0fcP14TDgd4CN7IO0l6JVkpfsI+ewwWfsTla8EwmEmdWEzjeDlmTx7HZ3uyTopKfwXKRJZ2ZjG4lVS41ZQ5c6joFagcEKgdKuHk9PCbNilQkiLyPDjZxuhRYRHVdHltWFvNOMVuVjYW0Jk1rK0vJnX5DRiJA+c2Ryn1KLF6i6j26ijr02AczMMynE/DhJH7wPX/HPp2JzGIWdg8hTg6c6l3qrGKAjUjAlWx+H7/flwv/Q04vzWMaSyNZlcu3fZs+ppUuGxK2i3pjNv13F6dxx3+FjnyJXBMn5Fi6kTbU4y2vxB9fz5CRwkzqzO8hm7lL0gUN8ENv6Z7GVJrIcfxhKbtkoL2UzLsAVqnXnh5vosp3kjC4wMobGSG81qVoAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;img_1.png&quot;
        title=&quot;&quot;
        src=&quot;/static/daa636f0456078be07333c434ced112e/f058b/img_1.png&quot;
        srcset=&quot;/static/daa636f0456078be07333c434ced112e/c26ae/img_1.png 158w,
/static/daa636f0456078be07333c434ced112e/6bdcf/img_1.png 315w,
/static/daa636f0456078be07333c434ced112e/f058b/img_1.png 630w,
/static/daa636f0456078be07333c434ced112e/40601/img_1.png 945w,
/static/daa636f0456078be07333c434ced112e/78612/img_1.png 1260w,
/static/daa636f0456078be07333c434ced112e/18d85/img_1.png 2382w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;자, 여기까지 이해했다면 내가 원인을 파악하기 위해 프레임워크를 디버깅하는 아주 비생산적인 행위를 했단 것을 알 수 있다.
이런 일이 없길 바란다면 API 사용자는 최대한 추적가능한 코드를 만들어야 한다.&lt;/p&gt;
&lt;p&gt;만약 나라면 생성자를 다양화하는 것이 아니라 클래스를 다양화를 선택했을 것 같다.
생성자의 호출부가 없어도 클래스 타입을 지정한 위치를 통해 사용사례를 파악할 수 있지 않을까?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Kotlin] Spring Mockk 리셋 이슈]]></title><description><![CDATA[컴퓨터는 거짓말을 하지 않는다. 하지만 내가 짠 테스트 코드는 거짓말을 하고 있었다.
분명 한번만 호출했지만 검증에서 두번 호출되었다고 실패하고 있었다. SpringMockk 에서 MockkBean, SpykBean 은 MockkClear…]]></description><link>https://seokchan-H.github.io/trouble-shooting/spring-mockk/spykbean-not-reset/</link><guid isPermaLink="false">https://seokchan-H.github.io/trouble-shooting/spring-mockk/spykbean-not-reset/</guid><pubDate>Fri, 10 Jan 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;컴퓨터는 거짓말을 하지 않는다. 하지만 내가 짠 테스트 코드는 거짓말을 하고 있었다.
분명 한번만 호출했지만 검증에서 두번 호출되었다고 실패하고 있었다.&lt;/p&gt;
&lt;p&gt;SpringMockk 에서 MockkBean, SpykBean 은 MockkClear 설정에 의해 Mocking 을 Reset 한다.
Reset 의 기본 설정은 MockkClear.AFTER 이다.&lt;/p&gt;
&lt;p&gt;문제는 이 기능이 AOP 로 래핑된 객체에 대해서 정상작동 하지 않는다는 것이다.
예를 들어 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;@Repository&lt;/code&gt; 가 적용된 객체는 테스트시 verify 가 갱신되지 않아 테스트 검증이 실패될 수 있다.&lt;/p&gt;
&lt;p&gt;해당 이슈는 CGLIB 기반의 프록시 객체에 대해서 발생한다.
그렇기에 다음과 같이 단순히 객체를 명시적으로 Reset 하면 실패하게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;    &lt;span class=&quot;token annotation builtin&quot;&gt;@SpykBean&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;lateinit&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; testClass&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; TestClass

    &lt;span class=&quot;token annotation builtin&quot;&gt;@BeforeEach&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;clearSpykBean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;clearMocks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;testClass&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3d9c4b46dea05d558c66d7b7dd02327a/f793b/img.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.556962025316455%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAo0lEQVR42j3OSQ6DMAwFUPYtw66oEkOcmQBhUivU+5/r10RVF09Oonzb2UAagQw25eBaQpkXSXW5l6hq1pbpnrOiKHG753g+aizaY+HcxnVnE58z6hWitPiYgLfyiJ1Mdn5/9RorScxE2ISGNQOsH6G0g7cBgSmh/ohlHYevDQ/+dPCUq/E17eR6cmD1M0Y3IYYIbXxqJnkTKQ2aVqDpiIkfwhfe1FRK9BDbjAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;img.png&quot;
        title=&quot;&quot;
        src=&quot;/static/3d9c4b46dea05d558c66d7b7dd02327a/f058b/img.png&quot;
        srcset=&quot;/static/3d9c4b46dea05d558c66d7b7dd02327a/c26ae/img.png 158w,
/static/3d9c4b46dea05d558c66d7b7dd02327a/6bdcf/img.png 315w,
/static/3d9c4b46dea05d558c66d7b7dd02327a/f058b/img.png 630w,
/static/3d9c4b46dea05d558c66d7b7dd02327a/40601/img.png 945w,
/static/3d9c4b46dea05d558c66d7b7dd02327a/78612/img.png 1260w,
/static/3d9c4b46dea05d558c66d7b7dd02327a/f793b/img.png 1404w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;해결방법은 AOP 가 Unwrap 된 객체를 기준으로 명시적인 Reset 을 수행하면 된다.
이를 위해 AopTestUtils 를 사용하면 다음과 같다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;    &lt;span class=&quot;token annotation builtin&quot;&gt;@SpykBean&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;lateinit&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; testClass&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; TestClass

    &lt;span class=&quot;token annotation builtin&quot;&gt;@BeforeEach&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;clearSpykBean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;clearMocks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AopTestUtils&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;getTargetObject&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;TestClass&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;testClass&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 이슈는 &lt;a href=&quot;https://github.com/Ninja-Squad/springmockk/issues/85&quot;&gt;@SpykBean not reset / cleared between tests #85&lt;/a&gt;에서 확인할 수 있다.
현재 SpringMockk 프로젝트는 2023년 3월 4.0.2 버전을 마지막으로 업데이트 되고 있지 않다.
하지만 &lt;a href=&quot;https://github.com/Ninja-Squad/springmockk/pull/112&quot;&gt;Migration to mock organization #112&lt;/a&gt; PR 에서 관리팀이 Ninja-Squad 에서 Mockk 로 이관 중임을 확인할 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Node.js] Express.js 서비스에 TSOA 적용하기.]]></title><description><![CDATA[새롭게 참여한 팀에서 API 스펙을 공유해달라는 요청을 받았다.
해당 팀은 API 스펙을 Postman 의 Request 로 공유하고 있었다. 내가 볼땐 매번 변경사항이 있을때마다 Request 를 갱신하는 것도 어렵지만,
Request…]]></description><link>https://seokchan-H.github.io/documentation/express/TSOA/</link><guid isPermaLink="false">https://seokchan-H.github.io/documentation/express/TSOA/</guid><pubDate>Sun, 01 Dec 2024 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;새롭게 참여한 팀에서 API 스펙을 공유해달라는 요청을 받았다.
해당 팀은 API 스펙을 Postman 의 Request 로 공유하고 있었다.&lt;/p&gt;
&lt;p&gt;내가 볼땐 매번 변경사항이 있을때마다 Request 를 갱신하는 것도 어렵지만,
Request 는 사용예시이기에 정확한 스펙을 공유하기엔 맞지 않다고 생각했다.
실제로 시간이 지남에 따라 스펙이 맞지 않는 문제를 겪고 있었다.&lt;/p&gt;
&lt;p&gt;나는 이 문제를 해결하기 위해 OpenAPI Specification (OAS) 를 사용하기로 했다.
OAS 는 Postman 의 APIs 서비스나 Swagger 라이브러리로 간단하게 UI 를 제공할 수 있다.
전자는 버전에 따라 API 스펙을 공유할 수 있고, 후자는 API 스펙을 코드로 생성할 수 있다.
나는 후자를 선택했다.&lt;/p&gt;
&lt;h2&gt;Node.js 의 Decorator&lt;/h2&gt;
&lt;p&gt;코드로 API 스펙을 생성하는 방법은 메타데이터를 관리하는 것으로 시작된다.
메타데이터는 코드의 구조정보인데, Node.js 진영에서는 이를 TypeScript 의 Decorator 로 관리할 수 있다.&lt;/p&gt;
&lt;p&gt;다음은 Decorator 를 사용하기 위한 tsconfig.json 의 설정이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;compilerOptions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;experimentalDecorators&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;emitDecoratorMetadata&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;experimentalDecorators 는 데코레이터 문법 (e.g. Class, Method) 을 사용할 수 있도록 한다.&lt;/li&gt;
&lt;li&gt;emitDecoratorMetadata 는 런타임에 메타데이터를 메모리에 적재하여 사용할 수 있도록 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;eperimental 접두사가 붙인 것은 아직 ECMAScript 표준이 아니기 때문이다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ECMAScript 표준화는 총 4단계를 거치며 3단계 이상이 되어야 엔진에 포함될 있다.
현재 Decorator 는 3단계에 있으며, TypeScript 는 이를 사용할 수 있도록 experimentalDecorators 옵션을 제공한다.&lt;/p&gt;
&lt;h2&gt;Nest.js vs TSOA&lt;/h2&gt;
&lt;p&gt;이제 메타데이터를 사용해서 OAS 를 작성해주는 라이브러리를 도입하면 된다.
Node.js 진영에서는 대표적으로 두가지 선택지가 있다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Nest.js 프레임워크를 사용한다.&lt;/li&gt;
&lt;li&gt;TypeScript OpenAPI (TSOA) 라이브러리를 사용한다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Nest 프레임워크를 사용하면 해당 진영에서 제공해주는 파워풀한 모듈들이 Decorator 패턴을 기반으로 쉽게 설정된다.
만약 내가 Node.js 기반의 프로젝트를 신규로 시작한다면 전자를 선택했을 것이다.
하지만 나는 Express.js 기반의 레거시 프로젝트에서 스펙문서를 제공해야하는 상황이기에
비교적 수정범위가 적은 TSOA 를 선택했다. TSOA 는 Interface 계층만 수정해주면 된다.&lt;/p&gt;
&lt;h2&gt;TSOA 설치하기&lt;/h2&gt;
&lt;p&gt;우선 TSOA 를 설치한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; tsoa&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음은 TSOA 를 사용하기 위한 tsconfig.json 의 설정이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;compilerOptions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;target&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;es2021&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;TSOA 에서 Promise.any 사용한다.
Promise.any 는 es2021 에서부터 제공된다.
es2021 는 Node.js 버전 16부터 지원된다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;이제 TSOA 를 설정할 차례이다.
프로젝트 루트에 tsoa.json 파일을 생성하고 다음과 같이 작성한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;entryFile&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;app.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Express.js 의 entry file 을 지정한다.&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;noImplicitAdditionalProperties&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;throw-on-extras&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 요청 객체에 정의되지 않은 프로퍼티가 있을때 에러를 발생시킨다.&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;controllerPathGlobs&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;controllers/**/*Controller.ts&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 컨트롤러 파일의 위치를 지정한다.&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;spec&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// OAS 파일을 생성할 때 필요한 설정을 지정한다.&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;outputDirectory&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./auto_generated/tsoa/swagger&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// OAS 파일을 생성할 위치를 지정한다.&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;specVersion&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// OAS 버전을 지정한다.&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;securityDefinitions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;sessionAuth&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 내가 사용할 보안방식의 이름을 지정하고 OAS 에 나타낼 보안방식을 정의한다. (실제 보안처리는 직접 작성한 모듈에서 진행한다.)&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;apiKey&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
        &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Cookie&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;in&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;header&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;routes&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 라우터 파일을 생성할 때 필요한 설정을 지정한다.&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;routesDir&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./auto_generated/tsoa/routes&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 라우터 파일을 생성할 위치를 지정한다.&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;authenticationModule&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./middleware/tsoa/expressAuthentication.ts&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 인증 모듈을 지정한다.&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;compilerOptions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;baseUrl&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;../&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;paths&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;@*&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;./*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// tsconfig.json 에서 지정한 symbolic link 를 tsoa 에도 지정해준다.&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;TSOA 설정은 크게 인터페이스를 담당하는 Route 코드와 이를 문서화한 OAS 파일을 생성하는 설정으로 나뉜다.
파일경로는 tsoa.json 기준으로 지정하면 된다.&lt;/p&gt;
&lt;h2&gt;TSOA 코드 작성하기&lt;/h2&gt;
&lt;h3&gt;Controller 작성하기&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Controller&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Route&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Get&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Post&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Body&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; SuccessResponse &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;tsoa&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Route&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/tsoa-samle&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TsoaSampleController&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Controller&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/data/{id}&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Security&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sessionAuth&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Request&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; req&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Request 객체 : 모듈에 의해 인증 &amp;amp; 저장된 사용자 정보를 가져올 수 있다. (i.e. req.user.id)&lt;/span&gt;
    &lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Path&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;dataId&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; dataId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Path Parameter&lt;/span&gt;
    &lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Query&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;optionId&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; optionId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Query Parameter&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Data&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; dataId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;data&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;인증 모듈 작성하기&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Request &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;express&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; expressAuthentication &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  request&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  securityName&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  scopes&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;securityName &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;sessionAuth&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 지정한 이름으로 인증처리를 분류한다.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isAuthenticated&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 인증 여부를 확인한다.&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Unauthorized or limit exceeded&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Unsupported security method: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;securityName&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;에러 핸들러 작성하기&lt;/h3&gt;
&lt;p&gt;TSOA 의 에러를 어플리케이션에서 사용중이던 에러포맷으로 치환한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; ValidateError &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;tsoa&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;express&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;express&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TSOAErrorHandler&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;isValidateError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;unknown&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; err &lt;span class=&quot;token keyword&quot;&gt;is&lt;/span&gt; ValidateError &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 타입가드 함수로 에러를 캐스팅합니다.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;object&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;fields&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; ValidateError&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fields &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;object&apos;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleValidateError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// TSOA 에러 발생시키는 에러를 어플리케이션 에러로 치환합니다.&lt;/span&gt;
    err&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Error&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    req&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; express&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Request&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    res&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; express&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    next&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; express&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NextFunction&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isValidateError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; newError &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CustomException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fields&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      newError&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stack &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stack&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// StackTrace 이력을 유지합니다.&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newError&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;에러 모듈을 기존 에러핸들러보다 먼저 등록한다. (next 로 처리되기에 순서가 중요하다.)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// TSOA 에러 핸들러 등록 : 기존 에러형태로 파싱하여 체이닝&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  TSOAErrorHandler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;handleValidateError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;라우터 생성하기&lt;/h3&gt;
&lt;p&gt;TSOA 는 작성된 Controller 를 기반으로 라우터 JS 파일을 생성한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;npx tsoa routes &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;생성된 파일에서 export 된 RegisterRoutes 함수로 앱에 라우터를 등록할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// TSOA 라우트 등록&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; RegisterRoutes &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./auto_generated/tsoa/routes/routes&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// tsoa.json 에 설정한 위치&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;RegisterRoutes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;express&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Swagger UI 생성하기&lt;/h3&gt;
&lt;p&gt;TSOA 는 작성된 Controller 를 기반으로 OAS 를 생성한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;npx tsoa spec &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;생성된 파일을 Swagger UI 에서 사용할 수 있도록 설정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Swagger UI 설정&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; swaggerUi &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;swagger-ui-express&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; swaggerDocument &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./auto_generated/tsoa/swagger/swagger&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// tsoa.json 에 설정한 위치&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/docs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; swaggerUi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;serve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; swaggerUi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;swaggerDocument&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;지정한 &lt;code class=&quot;language-text&quot;&gt;/docs&lt;/code&gt; 로 접근하면 Swagger UI 문서를 확인할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1186e1fffa3d2cc23d4b463da6886c84/26a94/swagger-ui-express.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRklEQVR42pWRvUoDQRSF9w1ENr2l1dpZaLIYiTZiJNoJBlL6LL6BvQ8gWFmIjZYaNUZQFCxM9i8bk7ibzO8eZ0cFlRUTmI9779w7h3MZY3rKRHlvBku1WczPLaC0WoJlWcjlcjBNc2KMQt7G1m4R5e0VrK9toFrdQaWyieJyEfnCImy7oLDHxuCcg8YSgkpwzkApgUwkEpkA6kiR3vOxMRhjCF+78IIA/cEAjuuhcfuEZ7eOhnMAt9+E4AkYo0hn/8NIlJvm3T0Oj45xcnqGi6sGrm8e8fByjnprH+3epXIJ7f63m0xBSilGI4IoitHr9UEIAUtXH6lHBCBDpntRFGniOMabjsO/BR3H1au22i6CTqiio2vPd+F5PvwgVLWvCYKOjmHYzXSpBX01RAiFlB8fIIT45HsuVF/86GU6/EpS4UnJEnwHEYVarcuqYFMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;img.png&quot;
        title=&quot;&quot;
        src=&quot;/static/1186e1fffa3d2cc23d4b463da6886c84/f058b/swagger-ui-express.png&quot;
        srcset=&quot;/static/1186e1fffa3d2cc23d4b463da6886c84/c26ae/swagger-ui-express.png 158w,
/static/1186e1fffa3d2cc23d4b463da6886c84/6bdcf/swagger-ui-express.png 315w,
/static/1186e1fffa3d2cc23d4b463da6886c84/f058b/swagger-ui-express.png 630w,
/static/1186e1fffa3d2cc23d4b463da6886c84/40601/swagger-ui-express.png 945w,
/static/1186e1fffa3d2cc23d4b463da6886c84/26a94/swagger-ui-express.png 1102w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이제 해당 URL 을 팀에 공유하면 된다.&lt;/p&gt;</content:encoded></item></channel></rss>